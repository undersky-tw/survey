<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>蘋天下 顧客問卷</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #dce3e8; /* ★ 修改：加深的灰藍色背景 */
            margin: 0; 
            padding: 16px; 
            color: #333; 
        }

        .container { max-width: 600px; margin: 0 auto; }
        
        .card { 
            background: #fff; 
            border-radius: 10px; 
            padding: 18px; 
            margin-bottom: 16px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.08); /* 陰影稍微加深一點點以配合深底色 */
        }

        .form-group { margin-bottom: 10px; }
        label.question-title { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 12px; 
            font-size: 16px; 
            color: #37474f; 
        }
        .required { color: #d32f2f; margin-left: 3px; }

        input[type="text"], textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #cfd8dc; 
            border-radius: 6px; 
            font-size: 16px; 
            box-sizing: border-box; 
            -webkit-appearance: none; 
            background-color: #fff;
        }
        
        input[readonly] { 
            background-color: #eceff1; 
            color: #546e7a; 
            border: 1px solid #cfd8dc;
            font-weight: 500;
        }

        .hidden-radio { display: none; }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px; 
        }

        .btn-option {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 14px 10px;
            background-color: #fff;
            border: 1px solid #cfd8dc; 
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            color: #455a64; 
            transition: background-color 0.1s, border-color 0.1s; 
            box-sizing: border-box;
            text-align: center;
        }

        .hidden-radio:checked + .btn-option {
            background-color: #455a64; 
            color: #ffffff;
            border-color: #455a64;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(69, 90, 100, 0.2);
        }

        .scale-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        .scale-option { padding: 12px 0; }

        .btn-submit { 
            background-color: #455a64; 
            color: white; 
            border: none; 
            padding: 16px; 
            width: 100%; 
            border-radius: 6px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .btn-submit:disabled { background-color: #b0bec5; }

        #success-message { display: none; text-align: center; padding: 40px 20px; }
        .check-icon { font-size: 50px; color: #455a64; margin-bottom: 20px; display: block; }
    </style>
</head>
<body>

    <div class="container" id="survey-form">
        <form id="myForm">
            <input type="hidden" id="repairId" name="repairId">
            <input type="hidden" id="receiver" name="receiver">
            <input type="hidden" id="technician" name="technician">

            <div class="card"><label class="question-title">請問您覺得服務人員的態度如何？<span class="required">*</span></label><div class="options-container"><input type="radio" name="q1" id="q1-1" value="非常滿意" class="hidden-radio" required><label for="q1-1" class="btn-option">非常滿意</label><input type="radio" name="q1" id="q1-2" value="還不錯" class="hidden-radio"><label for="q1-2" class="btn-option">還不錯</label><input type="radio" name="q1" id="q1-3" value="普通" class="hidden-radio"><label for="q1-3" class="btn-option">普通</label><input type="radio" name="q1" id="q1-4" value="不太行，有待加強" class="hidden-radio"><label for="q1-4" class="btn-option">不太行，有待加強</label><input type="radio" name="q1" id="q1-5" value="很糟糕" class="hidden-radio"><label for="q1-5" class="btn-option">很糟糕</label></div></div>
            <div class="card"><label class="question-title">請問您覺得服務人員的專業度如何？<span class="required">*</span></label><div class="options-container"><input type="radio" name="q2" id="q2-1" value="非常專業" class="hidden-radio" required><label for="q2-1" class="btn-option">非常專業</label><input type="radio" name="q2" id="q2-2" value="還不錯" class="hidden-radio"><label for="q2-2" class="btn-option">還不錯</label><input type="radio" name="q2" id="q2-3" value="普通" class="hidden-radio"><label for="q2-3" class="btn-option">普通</label><input type="radio" name="q2" id="q2-4" value="不太行，有待加強" class="hidden-radio"><label for="q2-4" class="btn-option">不太行，有待加強</label><input type="radio" name="q2" id="q2-5" value="可能要砍掉重練" class="hidden-radio"><label for="q2-5" class="btn-option">可能要砍掉重練</label></div></div>
            <div class="card"><label class="question-title">請問您對整個消費體驗的感覺如何？<span class="required">*</span></label><div class="options-container"><input type="radio" name="q3" id="q3-1" value="非常好的體驗" class="hidden-radio" required><label for="q3-1" class="btn-option">非常好的體驗</label><input type="radio" name="q3" id="q3-2" value="整體上還不錯" class="hidden-radio"><label for="q3-2" class="btn-option">整體上還不錯</label><input type="radio" name="q3" id="q3-3" value="普通" class="hidden-radio"><label for="q3-3" class="btn-option">普通</label><input type="radio" name="q3" id="q3-4" value="不太行，有待加強" class="hidden-radio"><label for="q3-4" class="btn-option">不太行，有待加強</label><input type="radio" name="q3" id="q3-5" value="很糟糕" class="hidden-radio"><label for="q3-5" class="btn-option">很糟糕</label></div></div>
            <div class="card"><label class="question-title">是否會推薦親友來蘋天下？<span class="required">*</span></label><p style="font-size:13px; color:#78909c; margin-top:-8px; margin-bottom: 12px;">(10分:絕對會 / 1分:絕對不可能)</p><div class="scale-grid"><input type="radio" name="q4" id="s10" value="10" class="hidden-radio" required><label for="s10" class="btn-option scale-option">10</label><input type="radio" name="q4" id="s9" value="9" class="hidden-radio"><label for="s9" class="btn-option scale-option">9</label><input type="radio" name="q4" id="s8" value="8" class="hidden-radio"><label for="s8" class="btn-option scale-option">8</label><input type="radio" name="q4" id="s7" value="7" class="hidden-radio"><label for="s7" class="btn-option scale-option">7</label><input type="radio" name="q4" id="s6" value="6" class="hidden-radio"><label for="s6" class="btn-option scale-option">6</label><input type="radio" name="q4" id="s5" value="5" class="hidden-radio"><label for="s5" class="btn-option scale-option">5</label><input type="radio" name="q4" id="s4" value="4" class="hidden-radio"><label for="s4" class="btn-option scale-option">4</label><input type="radio" name="q4" id="s3" value="3" class="hidden-radio"><label for="s3" class="btn-option scale-option">3</label><input type="radio" name="q4" id="s2" value="2" class="hidden-radio"><label for="s2" class="btn-option scale-option">2</label><input type="radio" name="q4" id="s1" value="1" class="hidden-radio"><label for="s1" class="btn-option scale-option">1</label></div></div>
            <div class="card"><label class="question-title">意見回饋 (可留空)</label><textarea name="q5" rows="3" placeholder="歡迎您的留言"></textarea></div>

            <button type="submit" id="btnSubmit" class="btn-submit">送出問卷</button>
        </form>
    </div>

    <div class="container" id="success-message">
        <div class="card" style="text-align: center; padding: 40px 20px;">
            <span class="check-icon">✅</span>
            <h2>感謝您的回饋！</h2>
            <p style="color: #666;">您的意見是我們進步的動力。</p>
        </div>
    </div>

    <script>
        // ★★★ 請替換成你的 Google Apps Script 網址 (結尾 /exec) ★★★
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw-你的部署ID/exec";
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('repairId').value = urlParams.get('id') || "無編號";
            document.getElementById('receiver').value = urlParams.get('r') || "";
            document.getElementById('technician').value = urlParams.get('t') || "";
            liff.init({ liffId: "2008598904-yJnqeEj3" });
        };

        document.getElementById('myForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerText = "資料傳送中...";

            const form = e.target;
            const data = {
                action: "save_survey",
                data: {
                    id: form.repairId.value,
                    receiver: form.receiver.value,
                    technician: form.technician.value,
                    q1: form.querySelector('input[name="q1"]:checked')?.value,
                    q2: form.querySelector('input[name="q2"]:checked')?.value,
                    q3: form.querySelector('input[name="q3"]:checked')?.value,
                    q4: form.querySelector('input[name="q4"]:checked')?.value,
                    q5: form.querySelector('textarea[name="q5"]').value
                }
            };

            // 使用 no-cors 解決 iOS 跨域問題
            fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(data)
            })
            .then(() => showSuccess())
            .catch(err => { console.error(err); showSuccess(); });
        });

        function showSuccess() {
            document.getElementById('survey-form').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            setTimeout(() => { if(liff.isInClient()) liff.closeWindow(); }, 3000);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>蘋天下 顧客問卷</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* 全域設定：背景改為低飽和度淺藍灰 */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f0f4f8; 
            margin: 0; 
            padding: 16px; 
            color: #333; 
        }

        .container { max-width: 600px; margin: 0 auto; }
        
        /* 卡片樣式 */
        .card { 
            background: #fff; 
            border-radius: 8px; 
            padding: 16px; 
            margin-bottom: 16px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }

        .form-group { margin-bottom: 10px; }
        label.question-title { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 12px; 
            font-size: 16px; 
            color: #202124;
        }
        .required { color: #d93025; margin-left: 3px; }

        /* 輸入框樣式 - 維修單號改為 AppSheet 風格的淡藍色底 */
        input[type="text"], textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #dadce0; 
            border-radius: 4px; 
            font-size: 16px; 
            box-sizing: border-box; 
            -webkit-appearance: none; 
        }
        input[readonly] { 
            background-color: #e3f2fd; /* 很淡的淺藍色 */
            color: #1967d2; /* 深藍色字體 */
            border: 1px solid #d2e3fc;
            font-weight: 500;
        }

        /* === AppSheet 風格按鈕核心 CSS === */
        /* 隱藏原始的圓圈 radio */
        .hidden-radio { display: none; }

        /* 選項容器：垂直排列，間距收窄 */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 8px; /* 間隔收窄 */
        }

        /* 按鈕外觀 (Label) */
        .btn-option {
            display: flex;
            justify-content: center; /* 文字水平置中 */
            align-items: center;    /* 文字垂直置中 */
            width: 100%;
            padding: 14px 10px;     /* 高度拉高 */
            background-color: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            color: #3c4043;
            transition: all 0.2s ease;
            box-sizing: border-box;
            text-align: center;
        }

        /* 按鈕被選中時的樣式 (模仿 AppSheet 藍) */
        .hidden-radio:checked + .btn-option {
            background-color: #1976d2; /* AppSheet 經典藍 */
            color: #ffffff;
            border-color: #1976d2;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(25, 118, 210, 0.3);
        }

        /* 1-10 分數的網格佈局 */
        .scale-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 一排5個 */
            gap: 8px;
        }
        .scale-option {
            padding: 12px 0; /* 分數按鈕高度 */
        }

        /* 送出按鈕 */
        .btn-submit { 
            background-color: #1976d2; 
            color: white; 
            border: none; 
            padding: 16px; 
            width: 100%; 
            border-radius: 6px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn-submit:disabled { background-color: #b0bec5; }

        /* 成功訊息 */
        #success-message { display: none; text-align: center; padding: 40px 20px; }
        .check-icon { font-size: 50px; color: #34c759; margin-bottom: 20px; display: block; }
    </style>
</head>
<body>

    <div class="container" id="survey-form">
        <form id="myForm">
            
<form id="myForm">
    <input type="hidden" id="repairId" name="repairId">
    <input type="hidden" id="receiver" name="receiver">
    <input type="hidden" id="technician" name="technician">

    <div class="card">
        

            <div class="card">
                <label class="question-title">請問您覺得服務人員的態度如何？<span class="required">*</span></label>
                <div class="options-container">
                    <input type="radio" name="q1" id="q1-1" value="非常滿意" class="hidden-radio" required>
                    <label for="q1-1" class="btn-option">非常滿意</label>

                    <input type="radio" name="q1" id="q1-2" value="還不錯" class="hidden-radio">
                    <label for="q1-2" class="btn-option">還不錯</label>

                    <input type="radio" name="q1" id="q1-3" value="普通" class="hidden-radio">
                    <label for="q1-3" class="btn-option">普通</label>

                    <input type="radio" name="q1" id="q1-4" value="不太行，有待加強" class="hidden-radio">
                    <label for="q1-4" class="btn-option">不太行，有待加強</label>

                    <input type="radio" name="q1" id="q1-5" value="很糟糕" class="hidden-radio">
                    <label for="q1-5" class="btn-option">很糟糕</label>
                </div>
            </div>

            <div class="card">
                <label class="question-title">請問您覺得服務人員的專業度如何？<span class="required">*</span></label>
                <div class="options-container">
                    <input type="radio" name="q2" id="q2-1" value="非常專業" class="hidden-radio" required>
                    <label for="q2-1" class="btn-option">非常專業</label>

                    <input type="radio" name="q2" id="q2-2" value="還不錯" class="hidden-radio">
                    <label for="q2-2" class="btn-option">還不錯</label>

                    <input type="radio" name="q2" id="q2-3" value="普通" class="hidden-radio">
                    <label for="q2-3" class="btn-option">普通</label>

                    <input type="radio" name="q2" id="q2-4" value="不太行，有待加強" class="hidden-radio">
                    <label for="q2-4" class="btn-option">不太行，有待加強</label>

                    <input type="radio" name="q2" id="q2-5" value="可能要砍掉重練" class="hidden-radio">
                    <label for="q2-5" class="btn-option">可能要砍掉重練</label>
                </div>
            </div>

            <div class="card">
                <label class="question-title">請問您對整個消費體驗的感覺如何？<span class="required">*</span></label>
                <div class="options-container">
                    <input type="radio" name="q3" id="q3-1" value="非常好的體驗" class="hidden-radio" required>
                    <label for="q3-1" class="btn-option">非常好的體驗</label>

                    <input type="radio" name="q3" id="q3-2" value="整體上還不錯" class="hidden-radio">
                    <label for="q3-2" class="btn-option">整體上還不錯</label>

                    <input type="radio" name="q3" id="q3-3" value="普通" class="hidden-radio">
                    <label for="q3-3" class="btn-option">普通</label>

                    <input type="radio" name="q3" id="q3-4" value="不太行，有待加強" class="hidden-radio">
                    <label for="q3-4" class="btn-option">不太行，有待加強</label>

                    <input type="radio" name="q3" id="q3-5" value="很糟糕" class="hidden-radio">
                    <label for="q3-5" class="btn-option">很糟糕</label>
                </div>
            </div>

            <div class="card">
                <label class="question-title">是否會推薦親友來蘋天下？<span class="required">*</span></label>
                <p style="font-size:13px; color:#666; margin-top:-8px; margin-bottom: 12px;">(10分:絕對會 / 1分:絕對不可能)</p>
                
                <div class="scale-grid">
                    <input type="radio" name="q4" id="s10" value="10" class="hidden-radio" required><label for="s10" class="btn-option scale-option">10</label>
                    <input type="radio" name="q4" id="s9" value="9" class="hidden-radio"><label for="s9" class="btn-option scale-option">9</label>
                    <input type="radio" name="q4" id="s8" value="8" class="hidden-radio"><label for="s8" class="btn-option scale-option">8</label>
                    <input type="radio" name="q4" id="s7" value="7" class="hidden-radio"><label for="s7" class="btn-option scale-option">7</label>
                    <input type="radio" name="q4" id="s6" value="6" class="hidden-radio"><label for="s6" class="btn-option scale-option">6</label>
                    
                    <input type="radio" name="q4" id="s5" value="5" class="hidden-radio"><label for="s5" class="btn-option scale-option">5</label>
                    <input type="radio" name="q4" id="s4" value="4" class="hidden-radio"><label for="s4" class="btn-option scale-option">4</label>
                    <input type="radio" name="q4" id="s3" value="3" class="hidden-radio"><label for="s3" class="btn-option scale-option">3</label>
                    <input type="radio" name="q4" id="s2" value="2" class="hidden-radio"><label for="s2" class="btn-option scale-option">2</label>
                    <input type="radio" name="q4" id="s1" value="1" class="hidden-radio"><label for="s1" class="btn-option scale-option">1</label>
                </div>
            </div>

            <div class="card">
                <label class="question-title">意見回饋 (可留空)</label>
                <textarea name="q5" rows="3" placeholder="歡迎您的留言"></textarea>
            </div>

            <button type="submit" id="btnSubmit" class="btn-submit">送出問卷</button>
        </form>
    </div>

    <div class="container" id="success-message">
        <div class="card" style="text-align: center; padding: 40px 20px;">
            <span class="check-icon">✅</span>
            <h2>感謝您的回饋！</h2>
            <p>您的意見是我們進步的動力。</p>
        </div>
    </div>

    <script>
        // ★★★ 請替換成你的 Google Apps Script 網址 (結尾 /exec) ★★★
        const SCRIPT_URL = "https://script.google.com/macros/s/你的部署ID/exec";
        
        // 1. 從網址讀取參數 (包含 id, r=接件人, t=主修師)
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // 填入隱藏欄位
            document.getElementById('repairId').value = urlParams.get('id') || "無編號";
            document.getElementById('receiver').value = urlParams.get('r') || "";
            document.getElementById('technician').value = urlParams.get('t') || "";
            
            // 初始化 LIFF
            liff.init({ liffId: "2008598904-yJnqeEj3" });
        };

        // 2. 送出表單
        document.getElementById('myForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerText = "資料傳送中...";

            const form = e.target;
            const data = {
                action: "save_survey",
                data: {
                    id: form.repairId.value,
                    receiver: form.receiver.value,     // ★ 新增
                    technician: form.technician.value, // ★ 新增
                    q1: form.querySelector('input[name="q1"]:checked')?.value,
                    q2: form.querySelector('input[name="q2"]:checked')?.value,
                    q3: form.querySelector('input[name="q3"]:checked')?.value,
                    q4: form.querySelector('input[name="q4"]:checked')?.value,
                    q5: form.querySelector('textarea[name="q5"]').value
                }
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data)
            })
            .then(() => {
                document.getElementById('survey-form').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                // 3秒後自動關閉 LIFF
                setTimeout(() => { if(liff.isInClient()) liff.closeWindow(); }, 3000);
            })
            .catch(err => {
                alert("傳送失敗，請檢查網路：" + err);
                btn.disabled = false;
                btn.innerText = "送出問卷";
            });
        });
    </script>
</body>
</html>
